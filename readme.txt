    Лицензия: http://www.freebsd.org/copyright/freebsd-license.html
    Страника примера: http://bufferoverflowx86.github.io/jstypograph.html

    JSTypography — скрипт, который вы можете скачать, установить на свой сайт и привязать к любой форме ввода. К примеру, к форме ввода сообщений на форумах, добавления новостей, статей, рассказов и т. п. Так же, вы можете скачать страницу примера типографа и обрабатывать тексты без подключения к интернету. Размер входного текста не ограничен, что немаловажно для книг. Имеет два режима работы — вывод нормального текста и вывод текста с HTML-разметкой. Так же типограф поддерживает английские правила типографики. JSTypography имеет большой набор правил обработки, который совершенствовался в течение не одного года. Он значительно превосходит по возможностям большинство типографов, включая типограф от Лебедева, и схож по возможностям с типографом от Eugene Spearance.
    JSTypography предлагается в 2-х видах.
    jstypography.js — полноценный скрипт для редактирования.
    jstypography_minified.js — сжатый скрипт для установки. Не отличается по функционалу, но имеет меньший размер.
    Возможности:
    При нажатии кнопки «Типографировать» ваш текст приведётся к типографскому виду. Основные возможности:

    1) Возможность установки на любой сайт и привязки к любой форме ввода, к примеру, к форме ввода сообщения на форуме.
    2) Неограниченный размер обрабатываемого текста.
    3) Замена "Кавычек и "вложенных и даже "дважды вложенных"" кавычек" на «ёлочки», „лапки“ и ‚коготки‘.
    4) Расстановка отступов или тегов <p>. Длина отступа равна четырём пробелам. Присутствует механизм для преобразования пробелов в понятный для html вид.
    5) Замена дефисов на тире, где надо.
    6) Замена дробей на соответствующие символы.
    7) Расстановка неразрывных пробелов.
    8) Внутри тегов <untypo> текст экранируется от обработки.
    9) Простановка отсутствующих на клавиатуре символов с помощью псеводфункций.
        Функция УДАР(буква) — поставит на букву ударе́ние.
        Функция СТРЛ(Направление) создаст символ стрелки. Направления: В,Н,П,Л,ЛП,ВН. Так же на стрелки заменяются ->, <-, <->
        Функция ГРАД(цифра) для указания градусов.
        Функция ПАРА(Римская/арабская цифра) для параграфа
        Функция ЕВРО(цифра) заменится на символ евро.
        Функция ФУНТ(буква) заменится на символ фунта.
        Функция ДЮЙМ(буква) заменится на дюйм.
        Функция КОРН(буква,цифра) подставит корень.
        Функция ИНТГ(буква,цифра) заменится на интеграл.
        Функция ГРЕЧ(лат.буква) заменит букву из латинского алфавита на наиболее подходящую букву из греческого алфавита (которые часто используюся в математических формулах).
        Функция ВЕРХ[0123456789+-=()ni] переведёт содержимое в верхний индекс.
        Функция НИЖН[0123456789+-=()] переведёт содержимое в нижний индекс.
        Все вышеописанные псевдофункции кроме СТРЛ, ГРЕЧ, ВЕРХ и НИЖН работают и без аргументов. В таком случае они заменятся на символ. К примеру, записи ГРАД(45) и 45ГРАД() идентичны и заменятся на 45°.
        Имена функций в английской обработке: ACNT, ARRW, DEGR, SECT, EURO, PUND, INCH, SQRT, INTG, GREK, SUPS, SUBS соответственно. 
    10) Автопростановка пробелов после знаков препинания, где присутствует однозначность.
    11) Исправление последовательности из двух или четырёх точек на многоточие.
    12) (tm), (r), (c) заменятся на ™, ® и ©.
    13) Вывод как в виде готовых символов, так и в виде html-кодов.
    14) Поддержка как русских, так и английских правил типографики.
    15) Возможность обработки лишь выделенного текста.
    16) Операции с числами:
        2x2 заменяется на 2×2;
        3^238 заменяется на 3²³⁸;
        +/- заменяется на ±;
        != заменяется на ≠;
        ~= заменяется на ≈;
        >=, <= заменяется на ≥, ≤;
        Некоторые дроби заменяются на соответствующие им символы. 
    17) Замена ' на апостроф.
    18) Исправление пунктуации, простановка дефисов в часто встречающихся ошибках.
    19) Привязка сокращений, предлогов и т. п.
    20) Удаление повторяющихся слов.
    21) Выделение из текста ссылок и почтовых ящиков (только в html).
    22) И множество других мелочей. 

    Скрипт не обрабатывает текст внутри кодов [code], [quote], <pre>, <script>, <style>, и <untypo>, не бьёт ссылки и html-коды. Скрипт не скрипт не может поставить знак тире внутри диапазонов и указаний пути: 3–5 яиц, Москва—Санкт-Петербург. Использование -- в таких случаях подразумевается. Исключениями являются диапазоны дат и времени (1999–2001 гг., XX—XXI вв., 14–24 сентября, 11:30–13:00, в апреле—мае), т. к. здесь всё однозначно. 

    Общая инструкция по установке:
    1) Загрузите один из двух вариантов скриптов (к примеру, jstypography_minified.js) на сайт.
    2) Привяжите типограф к форме ввода и установить его вызов при нажатии какой-нибудь кнопки. На самом деле, это не обязательно должна быть кнорка, и необязательно при нажатии. Это может быть кнопка добавления сообщения (типограф не «перебьёт» родную функцию кнопки), но я предпочитаю иметь отдельную кнопку для обработки, чтобы знать, что я буду иметь на выходе. Для этого, откройте код целевой страницы, и в теге <head> добавьте загрузку скрипта:
----------------------------------------------------------------------------------
<script type="text/javascript" src="http://path/jstypography_minified.js"></script>
----------------------------------------------------------------------------------
    где path — адрес до скрипта.
    Теперь, необходимо привязать скрипт к кнопке. После кнопки добавьте строку с установкой типографа:
----------------------------------------------------------------------------------
<script type="text/javascript">
    jstypograph ({параметры})
</script>
----------------------------------------------------------------------------------
    Теперь о параметрах. Параметры указываются через запятую, в формате JSON "параметр":"значение" (с кавычками). В случае, если значений несколько, к примеру, скрипт привязан к нескольким кнопкам, список значений указывается в квадратных скобках: "параметр":["значение1",...,"значениеN"]. Доступные параметры:
    "obj": кнопка (или несколько), на которой будет «висеть» типограф. Указывается либо строка с ID элемента-кнопки, либо сам элемент. В случае, если указывается напрямую элемент, его необходимо поместить в массив. Пример:
----------------------------------------------------------------------------------
    //Привязывает скрипт к кнопке с id="typograph"
    {obj:"typograph",...
    //Аналогично
    {obj:["typograph"],...
    //Аналогично
    {obj:[getElementById("typograph")],...
    //Привязывает скрипт к кнопкам с id="typograph" и id="typograph2"
    {obj:["typograph", "typograph2"],...
    //Неправильно! Элементы должны указываться только внутри массива
    {obj:getElementById("typograph"),...    
----------------------------------------------------------------------------------
    "nbspobj": кнопка, при нажатию которой будет производиться замена символов неразрывного пробела на строку &nbsp;. На некоторых форумах (в т.ч. Ucoz) неразрывные пробелы при отправке преобразуются в обычные, в то время как строка &nbsp; преобразуется в неразрывной пробел. Поэтому для корректной работы неразрывных пробелов и отступов необходимо привязать автозамену на &nbsp; на кнопку «Добавить сообщение». Необязательно.
    "bind": событие, по которому будет запускаться типограф. Пример:
----------------------------------------------------------------------------------
    ...,bind:"click",...
----------------------------------------------------------------------------------
    "language": язык. "rus" или "eng", третьего не дано. Необязательно.
    "type": режим вывода. "norm", что значит обычный режим или "html". Для сообщений на форуме следует выбирать "norm", а для публикаций новостей с HTML-разметкой — "html".
    "txts": обрабатываемая(ые) поля ввода, т.е., textarea. Указываются аналогично obj, может существовать несколько полей для обработки.
    "off": список отключаемых функций типографа, опять-таки в квадратных скобках. Отключаемые функции: "spaces" (простановка и удаление пробелов), "tabs" (разметка параграфов), "dashs" (тире и дефис), "chars" (символы), "quotes" (кавычки), "functions" (псевдофункции), "nbsp" (неразрывные пробелы), "br" (расстановка тегов <br>), "href" (выделение ссылок, доступно лишь в html), "h1" (выделение заголовков, доступно лишь в html). Необязательно.
    Пример (полная обработка текста для людей):
----------------------------------------------------------------------------------
jstypograph ({obj:"buttonID", bind:"click", language:"rus", type:"norm", txts: ["textareaID"], off: ["br"]});
----------------------------------------------------------------------------------
    Пример (то же самое, но с дополнительной заменой неразрывного пробела на строку &nbsp;):
----------------------------------------------------------------------------------
jstypograph ({obj:"buttonID", tabobj:"CommitButtonID", bind:"click", language:"rus", type:"norm", txts: ["textareaID"], off: ["br"]});
----------------------------------------------------------------------------------
    Пример (публикация в разметке HTML):
----------------------------------------------------------------------------------
jstypograph ({obj:"buttonID", bind:"click", language:"rus", type:"html", txts: ["textareaID"]});
----------------------------------------------------------------------------------
    Внимание! Скрипт работает только с BB-редакторами. С «визуальными» редакторами он несовместим. Ниже изложенные примеры обеспечивают работоспособность при переключении режима ввода сообщение в обычный режим.
    Ниже следуют «специализированные» инструкции по установке на форумы.

    Инструкция по установке на форум Ucoz (включены все опции кроме <br>, символьный режим, замена неразрывного пробела на строку &nbsp; перед отправкой):
    1) Зайдите в Панель Управления → Редактор страниц → Файловый менеджер.
    2) Выберите папку для загрузки скрипта, и загрузите на сайт файл jstypography_minified.js. После загрузки щёлкните по имени файла, и появится ссылка на него. Скопируйте её.
    3) Зайдите в Панель Управления → Редактор страниц → Управление дизайном модуля → Форум → Форма добавления сообщения.
    4) В начале кода добавьте строчку:
----------------------------------------------------------------------------------
<script type="text/javascript" src="http://your_site/jstypography_minified.js"></script>
----------------------------------------------------------------------------------
    Где http://your_site/jstypography_minified.js — ссылка на загруженный на шаге 2 скрипт.
    5) Найдите текст:
----------------------------------------------------------------------------------
<input style="width:110px;" id="frF17" class="postReset" type="reset" value="Отменить" />
----------------------------------------------------------------------------------
    Сразу после него добавьте пробел и текст кнопки:
----------------------------------------------------------------------------------
<input style="width:110px;" type="button" id="typograf" value="Типограф"/>
----------------------------------------------------------------------------------
    6) В конце всего кода добавьте строчку:
----------------------------------------------------------------------------------
<script type="text/javascript">jstypograph ({obj:"typograf", nbspobj:"frF16", bind:"click", type:"norm", txts:"message", off:"br"})</script>
----------------------------------------------------------------------------------
    Опционально: Установка кнопки <untypo> (при нажатии обрамляет выделенную область тегом <untypo>, внутри которого типографирование не производится).
    Если опция «Не использовать визуальный редактор комментариев» ВКЛЮЧЕНА:
    7) В конце всего кода добавьте строчку:
----------------------------------------------------------------------------------
    <script type="text/javascript">$('span#bc18').after('<span style="padding-right:1px;"><input type="button" title="Untypo" value="untypo" onclick="simpletag(\'untypo\',\'\',\'\',\'message\',\'\',true)" class="codeButtons" id="untypo" /></span>');</script>
----------------------------------------------------------------------------------
    Если опция «Не использовать визуальный редактор комментариев» НЕ ВКЛЮЧЕНА:
    7) В конце всего кода добавьте строчку:
----------------------------------------------------------------------------------
    <script type="text/javascript">$(window).bind("load",function(){$('div.wysibb-toolbar-container:last').after('<div class="wysibb-toolbar-container"><span class="wysibb-toolbar-btn wbb-untypo"><span class="ve-tlb-untypo btn-inner"></span></span></div>');});</script>
----------------------------------------------------------------------------------
    8) Зайдите в Панель Управления → Редактор страниц → Файловый менеджер.
    9) Выберите папку для загрузки картинки кнопки, и загрузите её на сайт. Со скриптом прилагается картинка для белого и чёрного фонов (untypo.png и untypo2.png). После загрузки щёлкните по имени файла, и появится ссылка на него. Скопируйте её.
    10) Зайдите в Панель Управления → Редактор страниц → Управление дизайном модуля → Общие шаблоны → Таблица стилей (CSS)
    11) В конце всего кода добавьте строчку:
----------------------------------------------------------------------------------
    .wysibb .ve-tlb-untypo {background: url('http://your_site/untypo.png') no-repeat scroll 5px 3px;width: 20px;}
----------------------------------------------------------------------------------
    где http://your_site/untypo.png — ссылка на картинку кнопки, полученная на шаге 9.

    Инструкция по установке на forum2x2 phpBB2 (включены все опции кроме <br>, символьный режим):
    1) Зайдите в Панель Управления → Модуль → HTML & JAVASCRIPT → Управление кодами Javascript → Создать новый Javascript
    2) Скопируйте в открывшееся окно содержимое jstypography.js. Выберите расположение «На всех страницах». Примените изменения.
    3) Зайдите в Панель Управления → Оформление → Шаблоны → Запостить & Личные сообщения → posting_body. В конец кода добавьте:
----------------------------------------------------------------------------------
<script type="text/javascript">$('input[name=post]').after('&nbsp;<input class="mainoption" type="button" id="typograph" name="typograph" value="Типограф" tabindex="9" accesskey="t" />');
$(window).bind("load",function(){
    jstypograph ({obj:"typograph", bind:"click", type:"norm", txts:[$(".sceditor-container textarea").get(0)], off:"br"});
});</script>
----------------------------------------------------------------------------------
    4) Повторите ту же операцию для Панель Управления → Оформление → Шаблоны → Общие настройки → viewtopic_body.
    Опционально: Установка кнопки <untypo> (при нажатии обрамляет выделенную область тегом <untypo>, внутри которого типографирование не производится).    
    5) Зайдите в Панель Управления → Оформление → Шаблоны → Запостить & Личные сообщения → posting_body.
    6) Найдите строку (эта строка появляется в коде на шаге 3):
----------------------------------------------------------------------------------
    jstypograph ({obj:"typograph", bind:"click", type:"norm", txts:[$(".sceditor-container textarea").get(0)], off:"br"});
----------------------------------------------------------------------------------
    После неё, добавьте:
----------------------------------------------------------------------------------
    $('a.sceditor-button-fahide').after('<a class="sceditor-button sceditor-button-untypo" unselectable="on" onclick="bbcode(\'<untypo>\',\'</untypo>\');" title="Запрещает типографскую обработку"><div unselectable="on">Запрещает типографскую обработку</div></a>');
----------------------------------------------------------------------------------
    6) Повторите ту же операцию для Панель Управления → Оформление → Шаблоны → Общие настройки → viewtopic_body.
    7) Загрузите на любой хостинг (к примеру http://www.servimg.com/, где вы регистрируетесь при регистрации сайта) картинку кнопки. Со скриптом прилагается картинка для белого и чёрного фонов (untypo.png и untypo2.png). Сохраните полученную ссылку.
    8) Зайдите в Панель Управления → Оформление → Картинки и цвета → Цвета → Каскадная таблица стилей CSS.
    9) В конце всего кода добавьте строки:
----------------------------------------------------------------------------------
.sceditor-button-untypo div {
  background: url('ссылка') !important;
}
----------------------------------------------------------------------------------
    где ссылка — ссылка на полученную на шаге 7 картинку.

    Большая просьба, по всем вопросам, пожеланиям, найденным ошибкам пишите на ICQ 436149026, либо на ящик buffer.overflow.x86(собака)gmail(точка)com . Так же буду благодарен за инструкции по установке на другие форумные и нефорумные движки.

    © Даниил Ерошенко «BufferOverflow» <buffer.overflow.x86(собака)gmail(точка)com>, UnderShot <mail(собака)undershot(точка)ru>, 2012–2018 год